var r="__SW_VERSION__",p={static:`skillscat-static-v${r}`,api:`skillscat-api-v${r}`},f=[/^\/_app\/immutable\//,/\.(?:js|css|woff2?|ttf|otf)$/,/\.(?:png|jpg|jpeg|webp|svg|gif|ico)$/,/^https:\/\/avatars\.githubusercontent\.com\//];function n(e,t,s){return{pattern:e,maxAge:t,staleWhileRevalidate:s,test:a=>e.test(a)}}var u=[n(/^\/api\/categories$/,300*1e3,600*1e3),n(/^\/api\/skills$/,60*1e3,120*1e3),n(/^\/api\/skills\/[^/]+$/,300*1e3,600*1e3),n(/^\/api\/skills\/[^/]+\/files$/,300*1e3,600*1e3),n(/^\/api\/skills\/[^/]+\/download$/,3600*1e3,7200*1e3),n(/^\/api\/search/,60*1e3,120*1e3),n(/^\/api\/registry\/search/,60*1e3,120*1e3),n(/^\/api\/registry\/skill\//,300*1e3,600*1e3)],d=[/^\/api\/auth\//,/^\/api\/favorites/,/^\/api\/tokens/,/^\/api\/device\//,/^\/api\/admin\//,/^\/api\/orgs\//,/^\/api\/submit/];var h="sw-cache-time";async function g(e){let t=await caches.open(p.static),s=await t.match(e);if(s)return s;let a=await fetch(e);return a.ok&&t.put(e,a.clone()),a}async function C(e,t){let s=await caches.open(p.api),a=await s.match(e),l=Date.now(),R=async()=>{try{let i=await fetch(e);if(i.ok){let c=new Headers(i.headers);c.set(h,l.toString());let S=new Response(i.body,{status:i.status,statusText:i.statusText,headers:c});await s.put(e,S)}}catch{}};if(a){let i=parseInt(a.headers.get(h)||"0",10),c=l-i;if(c<t.maxAge)return a;if(c<t.maxAge+t.staleWhileRevalidate)return R(),a}let o=await fetch(e);if(o.ok){let i=new Headers(o.headers);i.set(h,l.toString());let c=new Response(o.clone().body,{status:o.status,statusText:o.statusText,headers:i});s.put(e,c)}return o}function m(e){let t=e.href,s=e.pathname;return f.some(a=>a.source.startsWith("^https")?a.test(t):a.test(s))}function A(e){return d.some(t=>t.test(e))?null:u.find(t=>t.test(e))||null}async function E(){let e=await caches.keys(),t=Object.values(p);await Promise.all(e.filter(s=>!t.includes(s)).map(s=>caches.delete(s)))}self.addEventListener("install",e=>{console.log(`[SW] Installing version ${r}`),e.waitUntil(self.skipWaiting())});self.addEventListener("activate",e=>{console.log(`[SW] Activating version ${r}`),e.waitUntil(Promise.all([E(),self.clients.claim()]))});self.addEventListener("fetch",e=>{let t=e.request;if(t.method!=="GET")return;let s=new URL(t.url);if(s.protocol.startsWith("http")){if(m(s)){e.respondWith(g(t));return}if(s.pathname.startsWith("/api/")){let a=A(s.pathname);if(a){e.respondWith(C(t,a));return}}}});self.addEventListener("message",e=>{e.data?.type==="CLEAR_CACHE"&&e.waitUntil(caches.keys().then(t=>Promise.all(t.map(s=>caches.delete(s))))),e.data?.type==="GET_VERSION"&&e.ports[0]?.postMessage({version:r})});
